{"name":"Ensure that sinks are configured for all Log entries","slug":"gcp-logging-2","body":"It is recommended to create sink which will export copies of all the log entries.\n\n**Rationale**\n\nLog entries are held in Stackdriver Logging for a limited time known as the retention period. After that, the entries are deleted. To keep log entries longer, sink can export them outside of Stackdriver Logging. Exporting involves writing a filter that selects the log entries to export, and choosing a destination in Cloud Storage, BigQuery, or Cloud Pub/Sub. The filter and destination are held in an object called a sink. To ensure all log entries are exported using sink ensure that there is no filter configured for a sink. Sinks can be created in projects, organizations, folders, and billing accounts.","description":"","severity":1,"remediationDescription":"**From Console**\n\n1. Go to `Logging/Logs` by visiting https://console.cloud.google.com/logs/viewer?\n2. Click down arrow symbol on `Filter Bar` at rightmost corner and select `Convert to Advanced Filter`\n3. This will convert `Filter Bar` to `Advanced Filter Bar`\n4. Clear any text from `Advanced Filter` - This will ensure that `log-filter` is set to empty and hence it captures all the logs\n5. Click on `Submit Filter` and should display all logs\n6. Click `Create Export` it will open `Edit Export` Menu on right\n7. Configure `Sink Name`. In `sink service` click drop down `select destination` and select desired service to store exports, preferably `Cloud Storage`\n8. In `Select Destination` click drop down and select desired destination resource or If required create new.\n9. Click `Create Sink`\n\n**Using Command-Line**\n\nTo create a sink to export all log entries in google cloud storage bucket:\n\n```bash\ngcloud logging sinks create \u003csink-name\u003e storage.googleapis.com/\u003cdestination_bucket-name\u003e\n```\n\n**Note**\n\n1. Created sink by command-line above will export logs in storage bucket however alternately sink can be configured to export logs into BigQuery, or Cloud Pub/Sub or `Custom Destination`\n2. While creating sink option `--log-filter` is not used to ensure sink exporting all log entries.\n\n**Impact**\n\nThere are no costs or limitations in Stackdriver Logging for exporting logs, but the export destinations charge for storing or transmitting the log data.\n\n**Default Value**\n\nBy default, there are no sinks configured.\n\n**References**\n\n1. https://cloud.google.com/logging/docs/reference/tools/gcloud-logginghttps://cloud.google.com/logging/quotas\n2. https://cloud.google.com/logging/quotas\n3. https://cloud.google.com/logging/docs/export/\n4. https://cloud.google.com/logging/docs/export/using_exported_logs?hl=en_US\u0026_ga=2.8327026.-1306762988.1522230337#destinations\n5. https://cloud.google.com/logging/docs/export/configure_export_v2\n\n**Notes**\n\nFor Command-Line Audit and Remediation, Sink destination of type `Cloud Storage Bucket` is considered. However destination could be configured to `Cloud Storage Bucket` or `BigQuery` or `Cloud Pub\\Sub` or `Custom Destination`. CLI commands would change accordingly.","rules":[{"cloudProviders":["gcp"],"comparator":"eq","expectedResult":"[]","subjects":["CloudAccount"],"query":"gcp-logging-2-sinks-are-configured-for-all-log-entries","returnPath":""}]}