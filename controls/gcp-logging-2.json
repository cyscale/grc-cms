{
  "name": "Ensure sinks are configured for all Log entries",
  "slug": "gcp-logging-2",
  "body": "It is recommended to create a sink that will export copies of all the log entries. This can\r\nhelp aggregate logs from multiple projects and export them to a Security Information\r\nand Event Management (SIEM).\r\n\n**Rationale**\n\nLog entries are held in Cloud Logging. To aggregate logs, export them to a SIEM. To\r\nkeep them longer, it is recommended to set up a log sink. Exporting involves writing a\r\nfilter that selects the log entries to export, and choosing a destination in Cloud Storage,\r\nBigQuery, or Cloud Pub/Sub. The filter and destination are held in an object called a\r\nsink. To ensure all log entries are exported to sinks, ensure that there is no filter\r\nconfigured for a sink. Sinks can be created in projects, organizations, folders, and billing\r accounts.",
  "description": "",
  "severity": 1,
  "remediationDescription": "**From Console**\n\n1. Go to Logs Router by visiting [https://console.cloud.google.com/logs/router](https://console.cloud.google.com/logs/router).\n2. Click on the arrow symbol with `CREATE SINK` text.\r\n3. Fill out the fields for `Sink details`.\n4. Choose Cloud Logging bucket in the Select sink destination drop down menu.\n5. Choose a log bucket in the next drop down menu.\n6. If an inclusion filter is not provided for this sink, all ingested logs will be routed to\r the destination provided above. This may result in higher than expected resource\r usage.\r\n\r\n7. Click `Create Sink`\n\nFor more information, see\r\n[https://cloud.google.com/logging/docs/export/configure_export_v2#dest-create](https://cloud.google.com/logging/docs/export/configure_export_v2#dest-create).\n\n**Using Command-Line**\n\nTo create a sink to export all log entries in Google Cloud Storage bucket:\n\n```bash\ngcloud logging sinks create <sink-name> storage.googleapis.com/<destination_bucket-name>\n```\n\nSinks can be created for a folder or organization, which will include all projects:\n\n```bash\ngcloud logging sinks create <sink-name> storage.googleapis.com/DESTINATION_BUCKET_NAME --include-children --\rfolder=FOLDER_ID | --organization=ORGANIZATION_ID\n```\n\n**Note**\n\n1. . A sink created by the command-line above will export logs in storage buckets.\r\nHowever, sinks can be configured to export logs into BigQuery, or Cloud\r\nPub/Sub, or `Custom Destination`.\r\n2. While creating a sink, the sink option `--log-filter` is not used to ensure the sink\r\nexports all log entries.\r\n3. A sink can be created at a folder or organization level that collects the logs of all\r\nthe projects underneath bypassing the option `--include-children` in the gcloud\r\ncommand.\n\n**Impact**\n\nThere are no costs or limitations in Cloud Logging for exporting logs, but the export\r\ndestinations charge for storing or transmitting the log data.\r\n\n**Default Value**\n\nBy default, there are no sinks configured.\n\n**References**\n\n1. https://cloud.google.com/logging/docs/reference/tools/gcloud-logging\r\n2. https://cloud.google.com/logging/quotas\r\n3. https://cloud.google.com/logging/docs/routing/overview\r\n4. https://cloud.google.com/logging/docs/export/using_exported_logs\r\n5. https://cloud.google.com/logging/docs/export/configure_export_v2\r\n6. https://cloud.google.com/logging/docs/export/aggregated_exports\r\n7. https://cloud.google.com/sdk/gcloud/reference/beta/logging/sinks/list\r\n\n**Additional Information**\n\nFor Command-Line Audit and Remediation, the sink destination of type Cloud Storage Bucket is considered. However, the destination could be configured to Cloud Storage Bucket or BigQuery or Cloud Pub\\Sub or Custom Destination. Command Line Interface commands would change accordingly.",
  "rules": [
    {
      "cloudProviders": ["gcp"],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": ["Connector"],
      "query": "gcp-logging-2-sinks-are-configured-for-all-log-entries",
      "returnPath": ""
    }
  ],
  "alertForSecondaryOnly": false
}
