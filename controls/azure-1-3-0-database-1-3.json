{"name":"Ensure that 'Auditing' Retention is 'greater than 90 days'","slug":"azure-1-3-0-database-1-3","body":"SQL Server Audit Retention should be configured to be greater than 90 days.\n\n**Rationale**\n\nAudit Logs can be used to check for anomalies and give insight into suspected breaches or misuse of information and access.","description":"","severity":2,"remediationDescription":"**From Azure Console**\n\n1. Go to `SQL servers`\n2. For each server instance\n3. Click on `Auditing`\n4. Select `Storage Details`\n5. Set `Retention (days)` setting `greater than 90 days`\n6. Select `OK`\n7. Select `Save`\n\n**Using Azure PowerShell**\n\nFor each Server, set the retention policy to more than or equal to 90 days.\n\n###Log Analytics\n\n```powershell\nSet-AzSqlServerAudit -ResourceGroupName \u003cResource_Group\u003e -ServerName \u003cSQL_Server_name\u003e -RetentionInDays 90 -LogAnalyticsTargetState Enabled -WorkspaceResourceId \"/subscriptions/\u003csubscription ID\u003e/resourceGroups/insights-integration/providers/Microsoft.OperationalInsights/workspaces/\u003cworkspace name\u003e```\n\n###Blob Storage Example\n\n```powershell\nSet-AzSqlServerAudit -ResourceGroupName \u003cResource_Group\u003e -ServerName \u003cSQL_Server_name\u003e -RetentionInDays 90 -BlobStorageTargetState Enabled -StorageAccountResourceId \"/subscriptions/\u003csubscription_ID\u003e/resourceGroups/\u003cResource_Group\u003e/providers/Microsoft.Storage/storageAccounts/\u003cStorage_Account_name\u003e\"\n```\n\n**Default Value**\n\nBy default, SQL Server audit storage is disabled.\n\n**References**\n\n1. [https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-auditing)\n2. [https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/get-azurermsqlserverauditing?view=azurermps-5.2.0](https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/get-azurermsqlserverauditing?view=azurermps-5.2.0)\n3. [https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/set-azurermsqlserverauditing?view=azurermps-5.2.0](https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/set-azurermsqlserverauditing?view=azurermps-5.2.0)\n4. [https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-logging-threat-detection#lt-6-configure-log-storage-retention](https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-logging-threat-detection#lt-6-configure-log-storage-retention)","rules":[{"cloudProviders":["azure"],"comparator":"eq","expectedResult":"[]","subjects":["SQLServer"],"query":"azure-1-3-0-database-1-3-auditing-retention-is-greater-than-90-days","returnPath":""}]}