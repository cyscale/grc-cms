{
  "name": "Ensure that Service Account has no Admin privileges",
  "slug": "gcp-iam-3",
  "body": "A service account is a special Google account that belongs to your application or a VM, instead of to an individual end user. Your application uses the service account to call the Google API of a service, so that the users aren't directly involved. It's recommended not to use admin access for ServiceAccount.\n\n**Rationale**\n\nService accounts represent service-level security of the Resources (application or a VM) which can be determined by the roles assigned to it. Enrolling ServiceAccount with Admin rights gives full access to assigned application or a VM, ServiceAccount Access holder can perform critical actions like delete, update change settings etc. without the intervention of user, so It's recommended not to have Admin rights.\n\nThis recommendation is applicable only for `User-Managed user created` service account (Service account with nomenclature: `SERVICE_ACCOUNT_NAME@PROJECT_ID.iam.gserviceaccount.com`).",
  "description": "Service Accounts with Admin privileges",
  "severity": 2,
  "remediationDescription": "**From Console**\n\n1. Go to `IAM & admin/IAM` using https://console.cloud.google.com/iam-admin/iam\n2. Go to the `Members`\n3. Identify `User-Managed user created` service account with roles containing `*Admin` or role matching `Editor` or role matching `Owner`\n4. Click `Delete bin` icon to remove role from member (service account in this case)\n\n**Via CLI gcloud **\n\n1. Using a text editor, Remove `Role` which contains `roles/*Admin` or matched `roles/editor` or matches `roles/owner`. Add a role to the bindings array that defines the group members and the role for those members.\n\nFor example, to grant the role roles/appengine.appViewer to the `ServiceAccount` which is roles/editor, you would change the example shown below as follows:\n\n```json\n{\n\"bindings\": [\n{\n\"members\": [ \"serviceAccount:our-project-123@appspot.gserviceaccount.com\",\n],\n\"role\": \"roles/appengine.appViewer\"\n}, {\n],\n    \"role\": \"roles/owner\"\n   },\n{\n    \"members\": [\n\"serviceAccount:our-project-123@appspot.gserviceaccount.com\",\n\"serviceAccount:123456789012-compute@developer.gserviceaccount.com\" ],\n    \"role\": \"roles/editor\"\n}\n],\n\"etag\": \"BwUjMhCsNvY=\"\n\"members\": [\n \"user:email1@gmail.com\"\n}\n```\n\n2. Update the project's IAM policy:\ngcloud projects set-iam-policy PROJECT_ID iam.json\n\n**Impact**\n\nAfter removing `*Admin or Editor or Owner` role assignments from service accounts, may break functionality that uses impacted service accounts. Required role(s) should be assigned to impacted service accounts in order to restore broken functionalities.\n\n**Default Value**\n\nUser Managed (and not user created) default service accounts have Editor (roles/editor) role assigned to them to support GCP services they offer.\nBy Default there are no roles assigned to User Managed User created service accounts. \n\n**References**\n\n1. https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/ \n2. https://cloud.google.com/iam/docs/understanding-roles\n3. https://cloud.google.com/iam/docs/understanding-service-accounts\n\n**Notes**\n\nDefault (User managed but not User created) service accounts have `Editor (roles/editor)` role assigned to them to support GCP services they offer. Such Service accounts are: `PROJECT_NUMBER-compute@developer.gserviceaccount.com, PROJECT_ID@appspot.gserviceaccount.com`.",
  "rules": [
    {
      "cloudProviders": [
        "gcp"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "IAMUser",
        "IAMServiceAccount"
      ],
      "query": "gcp-iam-3-serviceaccount-has-no-admin-privileges",
      "returnPath": ""
    }
  ]
}