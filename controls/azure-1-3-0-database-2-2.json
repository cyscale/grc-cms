{"name":"Ensure that 'Vulnerability Assessment (VA)' is enabled on a SQL server by setting a Storage Account","slug":"azure-1-3-0-database-2-2","body":"Enable Vulnerability Assessment (VA) service scans for critical SQL servers and corresponding SQL databases.\n\n**Rationale**\n\nEnabling Azure Defender for SQL server does not enables Vulnerability Assessment capability for individual SQL databases unless storage account is set to store the scanning data and reports.The Vulnerability Assessment service scans databases for known security vulnerabilities and highlight deviations from best practices, such as misconfigurations, excessive permissions, and unprotected sensitive data. Results of the scan include actionable steps to resolve each issue and provide customized remediation scripts where applicable. Additionally an assessment report can be customized by setting an acceptable baseline for permission configurations, feature configurations, and database settings.\n\n**Impact**\n\nEnabling the Azure Defender for SQLfeatures will incur additional costs for each SQL server.","description":"","severity":2,"remediationDescription":"**From Azure Console**\n\n1. Go to `SQL servers`\n2. Select a server instance\n3. Click on `Security Center`\n4. Select `Configure` next to `Enabled at subscription-level`\n5. In Section `Vulnerability Assessment Settings`, Click `Storage Account`\n6. Choose Storage Account (Existing or `Create New`). Click `Ok`\n7. Click `Save`\n\n**Using Azure PowerShell**\n\nIf not already, Enable Azure Defender for a SQL:\n\n\u003e`Set-AZSqlServerThreatDetectionPolicy -ResourceGroupName \u003cresource group name\u003e -ServerName \u003cserver name\u003e -EmailAdmins $True`\n\nTo enable ADS-VA service by setting Storage Account\n\n\u003e`Update-AzSqlServerVulnerabilityAssessmentSetting`\n\u003e\n\u003e `-ResourceGroupName \"\\\u003cresource group name\\\u003e\"`\n\u003e \n\u003e` -ServerName \"\\\u003cServer Name\\\u003e\"`\n\u003e \n\u003e` -StorageAccountName \"\\\u003cStorage Name from same subscription and same Location\\\u003e\" `\n\u003e \n\u003e` -ScanResultsContainerName \"vulnerability-assessment\" `\n\u003e \n\u003e` -RecurringScansInterval Weekly -EmailSubscriptionAdmins $true `\n\u003e \n\u003e` -NotificationEmail @(\"mail1@mail.com\" , \"mail2@mail.com\")`\n\u003e \n\n**Default Value**\n\nBy default Azure Defender for SQL is not enabled for a SQL server. Enabling Azure Defender for SQL does not enable VA scanning by setting Storage Account automatically.\n\n**References**\n\n1. [https://docs.microsoft.com/en-us/azure/sql-database/sql-vulnerability-assessment](https://docs.microsoft.com/en-us/azure/sql-database/sql-vulnerability-assessment)\n2. [https://docs.microsoft.com/en-us/rest/api/sql/servervulnerabilityassessments/listbyserver](https://docs.microsoft.com/en-us/rest/api/sql/servervulnerabilityassessments/listbyserver)\n3. [https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Update-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0](https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Update-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0)\n4. [https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Get-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0](https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Get-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0)\n5. [https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-posture-vulnerability-management#pv-6-perform-software-vulnerability-assessments](https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-posture-vulnerability-management#pv-6-perform-software-vulnerability-assessments)","rules":null}