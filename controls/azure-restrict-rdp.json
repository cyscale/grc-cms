{
  "name": "Ensure RDP access from the Internet is evaluated and restricted",
  "slug": "azure-restrict-rdp",
  "severity": 3,
  "body": "Network security groups should be periodically evaluated for port misconfigurations. Where certain ports and protocols may be exposed to the Internet, they should be evaluated for necessity and restricted wherever they are not explicitly required.\n\n**Rationale**\n\nThe potential security problem with using RDP over the Internet is that attackers can use various brute force techniques to gain access to Azure Virtual Machines. Once the attackers gain access, they can use a virtual machine as a launch point for compromising other machines on an Azure Virtual Network or even attack networked devices outside of Azure.",
  "remediationDescription": "Where RDP is not explicitly required and narrowly configured for resources attached to the Network Security Group, Internet-level access to your Azure resources should be restricted or eliminated.\n\n**From Azure Console**\n\n1. Go to `Virtual Machines`\n2. For each virtual machine you want to restrict RDP for, under `Settings`, go to `Networking`\n3. In the list of inbound port rules, delete any `Allow` rule with port 3389 and with `Source` as `Any`, `Internet` or `0.0.0.0/0`. Review all `Allow` rules with port 3389 that have static IPs and remove the ones that are not necessary.\n\nFor internal access to relevant resources, configure an encrypted network tunnel such as:\n[ExpressRoute](https://docs.microsoft.com/en-us/azure/expressroute/)\n[Site-to-site VPN](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal)\n[Point-to-site VPN](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal)\n\n**Default Value**\n\nBy default, RDP access from internet is not enabled.\n\n**References**\n\n1. [https://docs.microsoft.com/en-us/azure/security/azure-security-network-security-best-practices#disable-rdpssh-access-to-azure-virtual-machines](https://docs.microsoft.com/en-us/azure/security/azure-security-network-security-best-practices#disable-rdpssh-access-to-azure-virtual-machines)\n2. [https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-network-security#ns-1-establish-network-segmentation-boundaries](https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-network-security#ns-1-establish-network-segmentation-boundaries)",
  "rules": [
    {
      "cloudProviders": [
        "azure"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "SecurityGroup"
      ],
      "query": "azure-1-3-0-networking-1-rdp-access-is-restricted-from-the-internet"
    }
  ]
}