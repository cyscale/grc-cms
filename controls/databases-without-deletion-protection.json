{
  "name": "Ensure databases have deletion protection enabled",
  "description": "Databases without deletion protection",
  "slug": "databases-without-deletion-protection",
  "body": "C﻿yscale looks for managed databases that instances cannot be accidentally deleted and make sure that your data remains safe. Deletion protection prevents any existing database instances from being deleted by users, unless the feature is explicitly disabled. ",
  "severity": 2,
  "remediationDescription": "D﻿epending on the provider and service that you use, check out the following resources:\n\n#### A﻿WS\n* [RDS: Modifying an Amazon RDS DB instance](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.DBInstance.Modifying.html)\n\n#### Azure\n* [Lock your resources to protect your infrastructure](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/lock-resources?tabs=json)\n\n#### GCP\n* [Cloud SQL](https://cloud.google.com/sql/docs/mysql/deletion-protection)\n\n#### Alibaba\n* [ApsaraDB](https://www.alibabacloud.com/help/en/apsaradb-for-rds/latest/modify-delection-protection)\n",
  "rules": [
    {
      "cloudProvider": [
        "azure"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "MySQLServer",
        "MySQLFlexibleServer",
        "PostgreSQLServer",
        "PostgreSQLFlexibleServer",
        "SQLServer"
      ],
      "query": "databases-without-delete-protection-azure"
    },
    {
      "cloudProvider": [
        "gcp"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "CloudSQLInstance"
      ],
      "query": "databases-without-delete-protection-gcp-cloudsql"
    },
    {
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "DBInstance"
      ],
      "query": "databases-without-delete-protection-aws-and-alibaba",
      "cloudProvider": [
        "aws"
      ]
    },
    {
      "cloudProvider": [
        "alibaba"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "DBInstance"
      ],
      "query": "databases-without-delete-protection-aws-and-alibaba"
    }
  ]
}