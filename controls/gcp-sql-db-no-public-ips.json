{
  "name": "Ensure BigQuery datasets are not anonymously or publicly accessible",
  "severity": 3,
  "rules": [
    {
      "query": "gcp-1-1-0-bigquery-1-bigquery-datasets-are-not-anonymously-or-publicly-accessible",
      "subjects": [
        "BigQueryTable"
      ],
      "cloudProviders": [
        "gcp"
      ],
      "comparator": "eq",
      "expectedResult": "[]"
    }
  ],
  "slug": "gcp-bigquery-publicly-accessible",
  "body": "It is recommended that the IAM policy on BigQuery datasets does not allow anonymous and/or public access.\n\n**Rationale**\n\nGranting permissions to `allUsers` or `allAuthenticatedUsers` allows anyone to access the dataset. Such access might not be desirable if sensitive data is being stored in the dataset. Therefore, ensure that anonymous and/or public access to a dataset is not allowed.\n\n**Impact**\n\nThe dataset is not publicly accessible. Explicit modification of IAM privileges would be necessary to make them publicly accessible.\n\n",
  "remediationDescription": "**From Google Cloud Console**\n\n1. Go to BigQuery by visiting: https://console.cloud.google.com/bigquery\n2. Select the dataset from `Explorer`\n3. Click `SHARING` near the right side of the window and select `Permissions`\n4. Review each attached role\n5. Click the delete icon for each member `allUsers` or `allAuthenticatedUsers`. On the popup, click `Remove`\n\n**From Google Cloud CLI**\n\nList the name of all datasets.\n\n```bash\nbq ls\n```\n\nRetrieve the data set details:\n\n```bash\nbq show --format=prettyjson <projectID>:<datasetName> <pathToFile>\n```\n\nIn the access section of the JSON file, update the dataset information to remove all roles containing allUsers or allAuthenticatedUsers. Update the dataset:\n\n```bash\nbq update --source <pathToFile> <projectID>:<datasetName>\n```\n\n**Prevention**\n\nYou can prevent Bigquery dataset from becoming publicly accessible by setting up the `Domain restricted sharing` organization policy at: https://console.cloud.google.com/iam-admin/orgpolicies/iamallowedPolicyMemberDomains.\n\n**Default Value**\n\nBy default, BigQuery datasets are not publicly accessible.\n\n**References**\n\n1. [https://cloud.google.com/bigquery/docs/dataset-access-controls](https://cloud.google.com/bigquery/docs/dataset-access-controls)",
  "alertForSecondaryOnly": false
}