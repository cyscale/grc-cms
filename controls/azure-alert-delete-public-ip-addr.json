{
  "alertForSecondaryOnly": false,
  "name": "Ensure that Activity Log Alert exists for Delete Public IP Address rule",
  "slug": "azure-alert-delete-public-ip-addr",
  "body": "Create an Activity Log Alert for the Delete Public IP Addresses event.\n\n**Rationale**\n\nMonitoring for Delete Public IP Addresses events gives insight into network access changes and may reduce the time it takes to detect suspicious activity.\n\n**Impact**\n\nThere will be a substantial increase in log size if there are a large number of administrative actions on a server.",
  "severity": 1,
  "remediationDescription": "**From Azure Console**\n\n1. Navigate to the `Monitor` blade.\n2. Select `Alerts`.\n3. Select `Create`.\n4. Select `Alert Rule`.\n5. Under `Scope`, click `Select scope`.\n6. Select your subscription and click `Apply`.\n7. Select the `Condition` tab.\n8. Under `Signal name`, click `Delete Public IP Address (Microsoft.Network/publicIPAddresses)`.\n9. Select the `Actions` tab.\n10. To use an existing action group, click `Select action groups`. To create a new action group, click `Create action group`. Fill out the appropriate details for the selection.\n11. Select the `Details` tab.\n12. Select a `Resource Group`, provide an `Alert rule name` and an optional `Alert rule description`.\n13. Click `Review + create`.\n14. Click `Create`.\n\n**Using Azure Command Line Interface**\n\nUse the below command to create an `Activity Log Alert` for `Delete Public IP Address`.\n\n```bash\naz monitor activity-log alert create --resource-group \"<resourceGroupName\" --condition category=Administrative and operationName=Microsoft.Network/publicIPAddresses/delete and level=verbose --scope \"/subscriptions/<subscriptionID>\" --name \"<activityLogRuleName>\" --subscription <subscriptionID> --action-group <actionGroupID> \n```\n\n**Using Azure Powershell**\n\nCreate the `conditions` object.\n\n```powershell\n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -Equal Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -Equal Microsoft.Network/publicIPAddresses/delete -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -Equal Verbose -Field level\n```\n\nGet the `Action Group` information and store it in a variable, then create a new `Action` object.\n\n```powershell\n$actionGroup = Get-AzActionGroup -ResourceGroupName <resourceGroupName> -Name <actionGroupName>\n$actionObject = New-AzActivityLogAlertActionGroupObject -Id $actionGroup.Id\n```\n\nCreate the `scope` variable.\n\n```powershell\n$scope = \"/subscriptions/<subscriptionID>\"\n```\n\nCreate the `Activity Log Alert Rule` for `Microsoft.Network/publicIPAddresses/delete`.\n\n```powershell\nNew-AzActivityLogAlert -Name \"<activityAlertRuleName>\" -ResourceGroupName \"<resourceGroupName>\" -Condition $conditions -Scope $scope -Location global -Action $actionObject -Subscription “<subscriptionID>” -Enabled $true\n```\n\n**Default Value**\n\nBy default, no monitoring alerts are created.\n\n**References**\n\n1. [https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement](https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement)\n2. [https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log](https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log)\n3. [https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate](https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate)\n4. [https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid](https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid)\n5. [https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-3-enable-logging-for-security-investigation](https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-3-enable-logging-for-security-investigation)",
  "rules": [
    {
      "cloudProviders": [
        "azure"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "CloudAccount"
      ],
      "query": "azure-logging-activity-log-alert-exists-for-delete-public-ip-address"
    }
  ]
}