{
  "slug": "azure-expiration-keys-key-vault",
  "name": "Ensure the Expiration Date is set for all Keys in Key Vaults",
  "remediationDescription": "**From Azure Console**\n\n1. Go to `Key vaults`\n2. For each Key vault, under `Objects`, select `Keys`\n3. For each Key, select `Yes` for `Enabled`\n4. For each Key, check `Set expiration date` and set an appropriate expiration date\n5. Select `Apply`\n\n**Using Azure Command Line Interface**\n\nUse the below command to set the expiration date on keys.\n\n```bash\naz keyvault key set-attributes --name <keyName> --vault-name <vaultName> --expires Y-m-d'T'H:M:S'Z'\n```\n\n**Using Azure PowerShell**\n\n```powershell\nSet-AzKeyVaultKeyAttribute -VaultName <vaultName> -Name <keyName> -Expires <dateTime>\n```\n\n**Default Value**\n\nBy default, keys do not expire.\n\n**References**\n\n1. [https://docs.microsoft.com/en-us/azure/key-vault/key-vault-whatis](https://docs.microsoft.com/en-us/azure/key-vault/key-vault-whatis)\n2. [https://docs.microsoft.com/en-us/rest/api/keyvault/about-keys--secrets-and-certificates#key-vault-secrets](https://docs.microsoft.com/en-us/rest/api/keyvault/about-keys--secrets-and-certificates#key-vault-secrets)\n3. [https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-data-protection#dp-6-use-a-secure-key-management-process](https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-data-protection#dp-6-use-a-secure-key-management-process)\n4. [https://docs.microsoft.com/en-us/powershell/module/az.keyvault/set-azkeyvaultsecretattribute?view=azps-0.10.0](https://docs.microsoft.com/en-us/powershell/module/az.keyvault/set-azkeyvaultsecretattribute?view=azps-0.10.0)",
  "body": "Ensure that all Keys in Azure Key Vaults have an expiration date set.\n\n**Rationale**\n\nThe Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The `exp` (expiration date) attribute identifies the expiration time on or after which the key MUST NOT be used for encryption of new data, wrapping of new keys, and signing. By default, keys never expire. It is thus recommended that keys are rotated in the key vault and there is an explicit expiration time set for all keys to enforce key rotation. This ensures that the keys cannot be used beyond their assigned lifetimes.\n\n**Impact**\n\nKeys cannot be used beyond their assigned expiry times respectively. Keys need to be rotated periodically wherever they are used.",
  "severity": 2,
  "rules": [
    {
      "cloudProviders": [
        "azure"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "subjects": [
        "KMSKey"
      ],
      "query": "azure-1-3-0-security-1-the-expiration-date-is-set-on-all-keys"
    }
  ]
}