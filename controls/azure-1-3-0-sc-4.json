{"name":"Ensure that Azure Defender is set to On for SQL servers on machines","slug":"azure-1-3-0-sc-4","body":"Turning on Azure Defender enables threat detection for SQL servers on machines, providing threat intelligence, anomaly detection, and behavior analytics in the Azure Security Center.\n\n**Rationale**\n\nEnabling Azure Defender for SQL servers on machines allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\n**Impact**\n\nTurning on Azure Defender in Azure Security Center incurs an additional cost per resource.","description":"","severity":1,"remediationDescription":"**From Azure Console**\n\n1. Go to `Security Center`\n2. Select `Pricing \u0026 settings` blade\n3. Click on the subscription name\n4. Select the `Azure Defender plans` blade\n5. On the line in the table for `SQL Servers on machines` Select `On` under `Plan`\n1. Select `Save` \n\nUsing Azure Command Line Interface 2.0\n\nUse the below command to enable Standard pricing tier for Storage\n\n```bash\naz account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/pricings/StorageAccounts?api-version=2018-06-01 -d@\"input.json\"'\n```\n\nWhere input.json contains the Request body json data as mentioned below.\n\n```json\n{\"id\": \"/subscriptions/\u003cYour_Subscription_Id\u003e/providers/Microsoft.Security/pricings/StorageAccounts\",\"name\": \"StorageAccounts\",\"type\": \"Microsoft.Security/pricings\",\"properties\": {\"SqlserverVirtualMachines\":\"Standard\"}}\n```\n\n**Default Value**\n\nBy default, Azure Defender off is selected.\n\nReferences:\n\n1.[https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-usage](https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-usage)\n2.[https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities](https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities)\n3.[https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update](https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update)\n4.[https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing](https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing)\n5.[https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-data-protection#dp-3-monitor-for-unauthorized-transfer-of-sensitive-data](https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-data-protection#dp-3-monitor-for-unauthorized-transfer-of-sensitive-data)","rules":[{"cloudProviders":["azure"],"comparator":"eq","expectedResult":"[]","subjects":["Pricing"],"query":"azure-1-3-0-sc-4-azure-defender-is-set-to-on-for-sql-servers-on-machines","returnPath":""}]}