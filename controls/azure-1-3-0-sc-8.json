{"name":"Ensure that Azure Defender is set to On for Key Vault","slug":"azure-1-3-0-sc-8","body":"Turning on Azure Defender enables threat detection for Key Vault, providing threat intelligence, anomalydetection, and behavior analytics in the Azure Security Center.\n\n**Rationale**\n\nEnabling Azure Defender for Key Vault allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\n**Impact**\n\nTurning on AzureDefender in Azure Security Center incurs an additional cost per resource.","description":"","severity":1,"remediationDescription":"**From Azure Console**\n\n1. Go to SecurityCenter\n\n2. Select Pricing \u0026 settingsblade\n\n3. Click on the subscription name\n\n4. Select the Azure Defender plansblade\n\n5. On the line in the table for Key VaultSelect Onunder Plan.\n\n6. Select Save\n\n**Using Azure Command Line Interface 2.0**\n\nUse the below command to enable Standard pricing tier for Storage\n\n```bash\n\naz account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/pricings/StorageAccounts?api-version=2018-06-01 -d@\"input.json\"'\n```\n\nWhere input.json contains the Request body json data as mentioned below.\n\n```json\n{\n    \"id\": \"/subscriptions/\u003cYour_Subscription_Id\u003e/providers/Microsoft.Security/pricings/StorageAccounts\",\n    \"name\": \"KeyVaults\",\n    \"type\": \"Microsoft.Security/pricings\",\n    \"properties\": {\n        \"pricingTier\": \"Standard\"\n    }\n}\n```\n**Default Value**\n\nBy default, Azure Defender off is selected.\n\n**References**\n\n1. [https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities](https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities)\n\n2. [https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list](https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list)\n\n3. [https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update](https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update)\n\n4. [https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing](https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing)\n\n5. [https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-identity-management#im-8-secure-user-access-to-legacy-applications](https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-identity-management#im-8-secure-user-access-to-legacy-applications)","rules":[{"cloudProviders":["azure"],"comparator":"eq","expectedResult":"[]","subjects":["Pricing"],"query":"azure-1-3-0-sc-8-azure-defender-is-set-to-on-for-key-vault","returnPath":""}]}