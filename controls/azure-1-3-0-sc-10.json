{
  "slug": "azure-1-3-0-sc-10",
  "name": "Ensure that Microsoft Cloud App Security (MCAS) integration with Security Center is selected",
  "body": "This setting enables Microsoft Cloud App Security (MCAS) integration with Security Center.\r\n\r\n**Rationale**\r\n\r\nSecurity Center offers an additional layer of protection by using Azure Resource Manager events, which is considered to be the control plane for Azure. By analyzing the Azure Resource Manager records, Security Center detects unusual or potentially harmful operations in the Azure subscription environment. Several of the preceding analytics are powered by Microsoft Cloud App Security. To benefit from these analytics, subscription must have a Cloud App Security license.MCAS works only with Standard Tier subscriptions.\r\n\r\n**Impact**\r\n\r\nMCAS works with Standard pricing tier Subscription.Choosing the Standard pricing tier of Azure Security Center incurs an additional cost per resource.",
  "description": "Microsoft Cloud App Security (MCAS) integration with Security Center is disabled.",
  "severity": 1,
  "remediationDescription": "**From Azure Console**\r\n\r\n1. Go to `Azure Security Center`\r\n2. Select `Security policy` blade\r\n3. Click On `Edit Settings` to alter the the security policy for a subscription\r\n4. Select the `Threat Detection` blade\r\n5. Check/Enable option `Allow Microsoft Cloud App Security to access my data`\r\n6. Select `Save`\r\n\r\n**Using Azure Command Line Interface 2.0**\r\n\r\nUse the below command to enable Standard pricing tier for Storage Accounts\r\n\r\n```bash\r\naz account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \r\n\r\nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" \r\n\r\nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/settings/MCAS?api-version=2019-01-01 -d@\"input.json\"'\r\n```\r\n\r\nWhere input.json contains the Request body json data as mentioned below.\r\n\r\n```json\r\n{\r\n    \"id\": \"/subscriptions/<Your_Subscription_Id>/providers/Microsoft.Security/settings/MCAS\",\r\n    \"kind\": \"DataExportSetting\",\r\n    \"type\": \"Microsoft.Security/settings\",\r\n    \"properties\": {\r\n        \"enabled\": true\r\n    }\r\n}\r\n```\r\n\r\n**Default Value**\r\n\r\nWith Cloud App Security license, these alerts are enabled by default.\r\n\r\n**References**\r\n\r\n1. [https://docs.microsoft.com/en-in/azure/security-center/security-center-alerts-service-layer#azure-management-layer-azure-resource-manager-preview](https://docs.microsoft.com/en-in/azure/security-center/security-center-alerts-service-layer#azure-management-layer-azure-resource-manager-preview)\r\n2. [https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/list](https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/list)\r\n3. [https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/update](https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/update)\r\n4. [https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-identity-management#im-8-secure-user-access-to-legacy-applications](https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-identity-management#im-8-secure-user-access-to-legacy-applications)",
  "rules": [
    {
      "cloudProviders": [
        "azure"
      ],
      "comparator": "eq",
      "expectedResult": "[]",
      "query": "azure-iam-account-summaries-with-mcas-enabled",
      "subjects": [
        "CloudAccount"
      ]
    }
  ]
}