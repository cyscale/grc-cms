{"name":"Ensure that Activity Log Alert exists for Create or Update Network Security Group","slug":"azure-1-3-0-logging-2-3","body":"Create an Activity Log Alert for the \"Create\" or \"Update Network Security Group\" event.\n\n**Rationale**\n\nMonitoring for \"Create\" or \"Update Network Security Group\" events gives insight into network access changes and may reduce the time it takes to detect suspicious activity.","description":"","severity":1,"remediationDescription":"**From Azure Console**\n\n1. Go to `Monitor`\n2. Select `Alerts`\n3. Click On `New Alert Rule`\n4. Under `Scope`, click `Select resource`\n5. Select the appropriate subscription under `Filter by subscription`\n6. Select `Network Security Groups` under `Filter by resource type`\n7. Select `All` for `Filter by location`\n8. Click on the subscription resource from the entries populated under `Resource`\n9. Verify Selection preview shows `All Network Security Groups` and your selected subscription name\n10. Click `Done`\n11. Under `Condition` click `Add Condition`\n12. Select `Create` or `Update Network Security Group` signal\n13. Click `Done`\n14. Under `Action group`, select `Add action groups` and complete creation process or select appropriate action group\n15. Under `Alert rule details`, enter `Alert rule name` and `Description`\n16. Select appropriate resource group to save the alert to\n17. Check `Enable alert rule upon creation` checkbox\n18. Click `Create alert rule`\n\n**Using Azure Command Line Interface**\n\nUse the below command to create an `Activity Log Alert` for `Create` or `Update Network Security Groups`\n\n```bash\naz account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 bash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" https://management.azure.com/subscriptions/$0/resourceGroups/\u003cResource_Group_To Create_Alert_In\u003e/providers/microsoft.insights/activityLogAlerts/\u003cUnique_Alert_Name\u003e?api-version=2017-04-01 -d@\"input.json\"'\n```\n\nWhere `input.json` contains the Request body JSON data as mentioned below.\n\n\u003e`{\"location\": \"Global\",\"tags\": {},\"properties\": {\"scopes\": [\"/subscriptions/\u003cSubscription_ID\u003e\"],\"enabled\": true,\"condition\": {\"allOf\": [{\"containsAny\": null,\"equals\": \"Administrative\",\"field\": \"category\"},{\"containsAny\": null,\"equals\": \"Microsoft.Network/networkSecurityGroups/write\",\"field\": \"operationName\"}]},\"actions\": {\"actionGroups\": [{\"actionGroupId\": \"/subscriptions/\u003cSubscription_ID\u003e/resourceGroups/\u003cResource_Group_For_Alert_Group\u003e/providers/microsoft.insights/actionGroups/\u003cAlert_Group\u003e\",\"webhookProperties\": null}]},}}`\n\nConfigurable Parameters for command line:\n\n\u003e`\u003cResource_Group_To Create_Alert_In\u003e`\n\u003e\n\u003e`\u003cUnique_Alert_Name\u003e`\n\nConfigurable Parameters for input.json:\n\n\u003e`\u003cSubscription_ID\u003e in scopes`\n\u003e\n\u003e`\u003cSubscription_ID\u003e in actionGroupId`\n\u003e\n\u003e`\u003cResource_Group_For_Alert_Group\u003e in actionGroupId`\n\u003e\n\u003e`\u003cAlert_Group\u003e in actionGroupId`\n\n**Default Value**\n\nBy default, no monitoring alerts are created.\n\n**References**\n\n1. [https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement](https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement)\n2. [https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log](https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log)\n3. [https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate](https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate)\n4. [https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid](https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid)\n5. [https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-logging-threat-detection#lt-4-enable-logging-for-azure-resources](https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-logging-threat-detection#lt-4-enable-logging-for-azure-resources)","rules":[{"cloudProviders":["azure"],"comparator":"eq","expectedResult":"[]","subjects":["CloudAccount"],"query":"azure-1-3-0-logging-2-3-activity-log-alert-exists-for-create-or-update-network-security-group","returnPath":""}]}